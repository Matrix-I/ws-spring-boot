<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8"/>
    <title>WebSocket JWT Test</title>
</head>
<body>
<h1>WebSocket with JWT</h1>
<button onclick="connect()">Connect</button>
<button onclick="sendMessage()">Send</button>
<div id="log"></div>

<script>
    let ws;

    async function connect() {
        // Get token from server
        const token = await fetch("http://localhost:8080/auth/token")
            .then(r => r.text());
        log("Token: " + token);

        ws = new WebSocket("ws://localhost:8080/ws?token=" + token);

        ws.onopen = () => log("Connected");
        ws.onmessage = e => log("Message: " + e.data);
        ws.onclose = () => log("Disconnected");
    }

    function sendMessage() {
        log("Sending message...");
        log(ws.readyState);
        if (ws && ws.readyState === WebSocket.OPEN) {
            ws.send("Hello from client");
        }
    }

    function log(msg) {
        document.getElementById("log").innerHTML += "<p>" + msg + "</p>";
    }
</script>
</body>
</html>
